---
title: Avaliação 2 – Séries do Banco Central
format: html
editor: visual
execute:
  echo: false
  warning: false
  message: false
---

> 

------------------------------------------------------------------------

# Pacotes e opções

```{r setup, include=FALSE}
options(bitmapType = "cairo")   # força png() usar Cairo
library(tidyverse)
library(GetBCBData)
library(gganimate)
library(gifski)
```

------------------------------------------------------------------------

# Funções auxiliares

```{r helpers}
norm_cols <- function(df) {
  if ("ref.date" %in% names(df)) df <- rename(df, data = `ref.date`)
  if ("ref_date" %in% names(df)) df <- rename(df, data = ref_date)
  rename(df, valor = value) |>
    filter(!is.na(data), !is.na(valor)) |>
    distinct(data, .keep_all = TRUE) |>
    arrange(data)
}

get_series_lab <- function(id, label, start) {
  gbcbd_get_series(id, first.date = start, last.date = Sys.Date()) |>
    norm_cols() |>
    mutate(label = label)
}
```

------------------------------------------------------------------------

# Gráfico 1 – IBCR (SP, RJ, MG)

```{r ibcr, warning=FALSE, message=FALSE}
ibcr <- bind_rows(
  get_series_lab(25392, "SP", as.Date("2015-01-01")),
  get_series_lab(25396, "RJ", as.Date("2015-01-01")),
  get_series_lab(25379, "MG", as.Date("2015-01-01"))
) |> rename(estado = label)

g1 <- ggplot(ibcr, aes(data, valor, colour = estado)) +
  geom_line(size = 1) +
  labs(title = "IBCR – Atividade Econômica Regional",
       subtitle = "{format(frame_time, '%b %Y')}",
       y = "Índice (2002 = 100)", x = NULL) +
  theme_minimal(base_size = 14) +
  transition_reveal(data)

animate(g1, fps = 6, end_pause = 12, width = 850, height = 450,
        units = "px", renderer = gifski_renderer("ibcr_anim.gif"))

knitr::include_graphics("ibcr_anim.gif")
```

------------------------------------------------------------------------

# Gráfico 2 – Índices de Preços

```{r precos, warning=FALSE, message=FALSE}
precos <- bind_rows(
  get_series_lab(433,  "IPCA",  as.Date("2015-01-01")),
  get_series_lab(188,  "INPC",  as.Date("2015-01-01")),
  get_series_lab(189,  "IGP-M", as.Date("2015-01-01")),
  get_series_lab(191,  "IPC-DI",as.Date("2015-01-01"))
) |> rename(indice = label)

g2 <- ggplot(precos, aes(indice, valor, fill = indice)) +
  geom_col(show.legend = FALSE) +
  labs(title = "Inflação Mensal – Comparação de Índices",
       subtitle = "{format(frame_time, '%b %Y')}",
       x = NULL, y = "% no mês") +
  theme_minimal(base_size = 14) +
  transition_reveal(data) +
  ease_aes("linear")

animate(g2, fps = 6, end_pause = 12, width = 850, height = 450,
        units = "px", renderer = gifski_renderer("indices_anim.gif"))

knitr::include_graphics("indices_anim.gif")
```

------------------------------------------------------------------------

# Gráfico 3 – IPCA Geral

```{r ipca, warning=FALSE, message=FALSE}
ipca <- gbcbd_get_series(433, first.date = as.Date("2000-01-01"), last.date = Sys.Date()) |>
  norm_cols()

g3 <- ggplot(ipca, aes(data, valor)) +
  geom_line(colour = "#ca0020", size = 1.2) +
  labs(title = "Variação Mensal do IPCA",
       subtitle = "{format(frame_time, '%b %Y')}",
       y = "%", x = NULL) +
  theme_minimal(base_size = 14) +
  transition_reveal(data)

animate(g3, fps = 6, end_pause = 12, width = 850, height = 450,
        units = "px", renderer = gifski_renderer("ipca_anim.gif"))

knitr::include_graphics("ipca_anim.gif")
```

------------------------------------------------------------------------

# 
